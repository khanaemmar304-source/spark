<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‚ö° Spark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>

    <style>
      /* Glassmorphism effect */
      .glass {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }

      /* Spark Gradient Text */
      .spark-gradient {
        background: linear-gradient(90deg, #ff00cc, #3333ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Smooth transitions */
      button,
      input,
      textarea {
        transition: all 0.2s ease-in-out;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-thumb {
        background: #ff00cc;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #ff66ff;
      }
    </style>
  </head>

  <body class="flex flex-col items-center justify-center min-h-screen bg-[#0a0a0a] text-white font-[Inter]">
    <!-- Navbar -->
    <nav
      class="fixed top-0 left-0 w-full flex justify-between items-center px-8 py-4 bg-black/40 backdrop-blur-lg border-b border-gray-800 z-50"
    >
      <h1 class="text-2xl font-bold spark-gradient">‚ö° Spark</h1>
      <div class="space-x-6">
        <button id="aboutBtn" class="text-gray-300 hover:text-pink-400">About</button>
        <button id="logoutBtnNav" class="text-gray-300 hover:text-pink-400 hidden">Logout</button>
      </div>
    </nav>

    <!-- LOGIN PAGE -->
    <div id="loginSection" class="w-full max-w-md glass rounded-2xl p-6 text-center mt-32">
      <h1 class="text-4xl font-bold mb-4 spark-gradient">‚ö° Spark Login</h1>
      <input
        id="email"
        type="email"
        placeholder="Email"
        class="w-full bg-transparent border border-gray-600 rounded-lg p-3 mb-3 text-white focus:ring-2 focus:ring-pink-500 outline-none"
      />
      <input
        id="password"
        type="password"
        placeholder="Password"
        class="w-full bg-transparent border border-gray-600 rounded-lg p-3 mb-4 text-white focus:ring-2 focus:ring-pink-500 outline-none"
      />
      <button
        id="loginBtn"
        class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:opacity-90 text-white font-bold py-3 rounded-lg transition"
      >
        Sign In / Sign Up
      </button>
      <p id="loginStatus" class="mt-3 text-sm text-gray-400"></p>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="hidden flex w-full max-w-7xl mt-24">
      <!-- Sidebar -->
      <aside class="w-64 glass rounded-2xl p-6 h-[80vh] flex flex-col space-y-6 sticky top-24">
        <h2 class="text-xl font-semibold mb-3 text-pink-400">Features</h2>
        <ol class="space-y-3 text-gray-300 font-medium">
          <li>
            <button
              id="navGenerate"
              class="w-full text-left py-2 px-3 rounded-lg hover:bg-pink-600/20 transition"
            >
              ‚ö° Generate Ideas
            </button>
          </li>
          <li>
            <button
              id="navRank"
              class="w-full text-left py-2 px-3 rounded-lg hover:bg-pink-600/20 transition"
            >
              üß† Analyze My Idea
            </button>
          </li>
        </ol>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 ml-8">
        <!-- Generate Ideas Section -->
        <div id="mainSection" class="block">
          <h1 class="text-5xl font-extrabold mb-6 spark-gradient">‚ö° Spark Startup Idea Generator</h1>
          <div class="glass w-full max-w-lg rounded-2xl p-6 mb-8">
            <label class="block text-gray-300 font-semibold mb-2">Enter a topic or industry:</label>
            <input
              id="topicInput"
              type="text"
              placeholder="e.g. sustainable fashion, AI healthcare..."
              class="w-full bg-transparent border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-pink-500 outline-none mb-4"
            />
            <button
              id="generateBtn"
              class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:opacity-90 text-white font-bold py-3 rounded-lg transition"
            >
              Generate Ideas
            </button>
          </div>

          <div id="loading" class="hidden flex items-center space-x-3 text-pink-400 font-medium">
            <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8v8z"
              ></path>
            </svg>
            <span>Generating startup ideas...</span>
          </div>

          <div id="ideasContainer" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 w-full mt-10"></div>
        </div>

        <!-- Rank Idea Section -->
        <div id="rankSection" class="hidden">
          <h2 class="text-4xl font-extrabold mb-6 text-pink-400">üß† Analyze My Idea</h2>
          <div class="glass w-full max-w-lg rounded-2xl p-6 mb-8">
            <label class="block text-gray-300 font-semibold mb-2">Describe your startup idea:</label>
            <textarea
              id="ideaInput"
              placeholder="Explain your startup idea..."
              class="w-full bg-transparent border border-gray-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-pink-500 outline-none mb-4 h-32"
            ></textarea>
            <button
              id="rankBtn"
              class="w-full bg-gradient-to-r from-purple-600 to-pink-500 hover:opacity-90 text-white font-bold py-3 rounded-lg transition"
            >
              Rank My Idea
            </button>
          </div>

          <div id="rankResult" class="glass w-full max-w-lg rounded-2xl p-6 text-gray-300 hidden">
            <h3 class="text-2xl font-bold text-pink-400 mb-3">üß© Evaluation</h3>
            <p id="rating" class="text-lg font-semibold"></p>
            <p id="market" class="mb-3"></p>
            <div>
              <h4 class="font-semibold text-green-400">‚úÖ Pros</h4>
              <ul id="pros" class="list-disc ml-6 mb-3"></ul>
              <h4 class="font-semibold text-red-400">‚ö†Ô∏è Cons</h4>
              <ul id="cons" class="list-disc ml-6"></ul>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const SUPABASE_URL = "https://dqssjmxviqhbhporsvse.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRxc3NqbXh2aXFoYmhwb3JzdnNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MTk1NzMsImV4cCI6MjA3ODE5NTU3M30.dHfs-wnNaqcSAar4ALjNDDuMOB0P1dn1kiW29N-xMr4";
      const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const loginSection = document.getElementById("loginSection");
      const dashboard = document.getElementById("dashboard");
      const mainSection = document.getElementById("mainSection");
      const rankSection = document.getElementById("rankSection");
      const loginBtn = document.getElementById("loginBtn");
      const loginStatus = document.getElementById("loginStatus");
      const logoutBtnNav = document.getElementById("logoutBtnNav");
      const navGenerate = document.getElementById("navGenerate");
      const navRank = document.getElementById("navRank");

      async function checkSession() {
        const { data } = await client.auth.getSession();
        if (data.session) showDashboard();
      }
      checkSession();

      loginBtn.addEventListener("click", async () => {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        if (!email || !password)
          return (loginStatus.textContent = "‚ùå Please fill in both fields.");

        loginStatus.textContent = "‚è≥ Signing in...";
        const { data, error } = await client.auth.signInWithPassword({
          email,
          password,
        });
        if (error) {
          if (error.message.includes("Invalid login")) {
            const { error: signUpErr } = await client.auth.signUp({
              email,
              password,
            });
            if (signUpErr) loginStatus.textContent = "‚ùå " + signUpErr.message;
            else
              loginStatus.textContent =
                "‚úÖ Account created! Check your email.";
          } else loginStatus.textContent = "‚ùå " + error.message;
        } else showDashboard();
      });

      logoutBtnNav.onclick = async () => {
        await client.auth.signOut();
        dashboard.classList.add("hidden");
        loginSection.classList.remove("hidden");
        logoutBtnNav.classList.add("hidden");
      };

      function showDashboard() {
        loginSection.classList.add("hidden");
        dashboard.classList.remove("hidden");
        logoutBtnNav.classList.remove("hidden");
      }

      // Navigation buttons
      navGenerate.onclick = () => {
        mainSection.classList.remove("hidden");
        rankSection.classList.add("hidden");
      };
      navRank.onclick = () => {
        mainSection.classList.add("hidden");
        rankSection.classList.remove("hidden");
      };

      // Generate Ideas
      const generateBtn = document.getElementById("generateBtn");
      const topicInput = document.getElementById("topicInput");
      const ideasContainer = document.getElementById("ideasContainer");
      const loading = document.getElementById("loading");

      generateBtn.addEventListener("click", async () => {
        const topic = topicInput.value.trim();
        if (!topic) return alert("Please enter a topic first.");

        ideasContainer.innerHTML = "";
        loading.classList.remove("hidden");

        try {
          const response = await fetch("https://spark-x4pk.onrender.com/generate-ideas", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ topic }),
          });
          const data = await response.json();
          loading.classList.add("hidden");

          if (!data.ideas)
            return (ideasContainer.innerHTML = `<p class='text-gray-400 text-center'>No ideas found. Try again!</p>`);

          ideasContainer.innerHTML = data.ideas
            .map(
              (idea, i) => `
            <div class="idea-card glass rounded-2xl p-6 border border-gray-700 hover:shadow-lg hover:translate-y-[-4px] transition">
              <h2 class="text-xl font-bold text-pink-400 mb-3">üí° Idea ${
                i + 1
              }: ${idea.name}</h2>
              <p class="text-gray-300 mb-2"><strong>üß© Problem:</strong> ${
                idea.problem
              }</p>
              <p class="text-gray-300 mb-2"><strong>üöÄ Solution:</strong> ${
                idea.solution
              }</p>
              <p class="text-gray-300"><strong>üí∞ Why it works:</strong> ${
                idea.why
              }</p>
            </div>
          `
            )
            .join("");
        } catch {
          loading.classList.add("hidden");
          ideasContainer.innerHTML = `<p class="text-red-500 text-center">‚ùå Error generating ideas.</p>`;
        }
      });

      // Rank Idea
      const rankBtn = document.getElementById("rankBtn");
      const rankResult = document.getElementById("rankResult");

      rankBtn.addEventListener("click", async () => {
        const idea = document.getElementById("ideaInput").value.trim();
        if (!idea) return alert("Please describe your idea first.");

        rankResult.classList.add("hidden");
        rankBtn.textContent = "‚è≥ Evaluating...";
        try {
          const response = await fetch("https://spark-x4pk.onrender.com/rank-idea", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ idea }),
          });
          const data = await response.json();
          rankBtn.textContent = "Rank My Idea";
          if (data.error) throw new Error(data.error);

          document.getElementById("rating").innerHTML = `‚≠ê Rating: ${data.rating}`;
          document.getElementById("market").innerHTML = `üåç Market: ${data.market}`;
          document.getElementById("pros").innerHTML = data.pros
            .map((p) => `<li>${p}</li>`)
            .join("");
          document.getElementById("cons").innerHTML = data.cons
            .map((c) => `<li>${c}</li>`)
            .join("");
          rankResult.classList.remove("hidden");
        } catch {
          rankBtn.textContent = "Rank My Idea";
          alert("‚ùå Failed to rank idea.");
        }
      });
    </script>
  </body>
</html>
